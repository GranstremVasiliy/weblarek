# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.


## Данные

### Товар
Товар — основная сущность приложения, отражающая информацию о каждом продукте, доступном в интернет-магазине «Web-Ларёк».
Данные о товарах используются для отображения карточек на главной странице, показа подробной информации в модальных окнах и формирования корзины покупок.

#### Интерфейс IProduct
Интерфейс IProduct описывает структуру данных, которые представляет один товар в интернет-магазине.
Он используется для типизации объектов, получаемых от сервера, и служит основой для моделей и компонентов, работающих с товарами.

#### Модель CatalogModel 
отвечает за хранение и управление списком товаров, а также за работу с выбранным товаром, который пользователь открывает для просмотра или добавления в корзину. Эта модель используется презентером для взаимодействия между данными и представлением каталога.

Класс CatalogModel
Класс реализует логику управления каталогом и выбранной карточкой товара.
Он не взаимодействует напрямую с DOM и работает только с данными, используя типы, описанные в интерфейсе IProduct.

Поля класса: 
`private items: IProduct[] = [];` - Массив всех товаров, полученных с сервера;
`private selectedItem: IProduct | null = null;` - Текущая выбранная карточка товара;

Методы класса: 
`getItems(): IProduct[];` - Возвращает список всех товаров;
`setItems(items: IProduct[]): void;` - Сохраняет массив товаров в модель;
`setSelectedItem(item: IProduct): void;` - Сохраняет выбранный товар;
`getSelectedItem(): IProduct | null` - Возвращает выбранный товар;
`getItemById(id: string): IProduct | undefined` - Возвращает товар по указанному id, или undefined, если товар не найден.

#### Модель CartModel 
Отвечает за хранение и управление данными корзины.
Она содержит список добавленных товаров и предоставляет методы для работы с ними — добавление, удаление, подсчёт общего количества и стоимости товаров, а также проверку наличия определённого товара.

Класс CartModel  содержит массив товаров и методы для управления этим массивом — добавления, удаления, подсчёта количества и стоимости.
Класс используется презентером для взаимодействия с данными корзины и отображения актуального состояния в интерфейсе.

Поле класса:
`private items: IProduct[] = [];` - Массив товаров, добавленных пользователем в корзину;

Методы класса:
`addItem(item: IProduct): void` - Добавляет товар в корзину;
`removeItem(item: IProduct): void` - Удаляет переданный товар из корзины;
`getItems(): IProduct[]` - Возвращает список всех товаров в корзине;
`getCount(): number` - Возвращает количество товаров в корзине;
`getTotal(): number` - Возвращает общую стоимость всех товаров в корзине;
`hasItem(id: string): boolean` - Проверяет, есть ли товар с указанным идентификатором в корзине;
`clear(): void` - Очищает корзину, удаляя все товары.

### Покупатель
Покупатель — это сущность, описывающая данные пользователя, необходимые для оформления и отправки заказа в интернет-магазине «Web-Ларёк».
Эти данные заполняются пользователем на этапе оформления покупки и передаются на сервер вместе с составом заказа.

#### Интерфейс ICustomer
Интерфейс ICustomer определяет структуру объекта, содержащего сведения о покупателе и выбранном способе оплаты.


#### Модель CustomerModel отвечает за хранение и управление данными покупателя.
Она обеспечивает проверку корректности введённых данных, сохранение и получение информации, необходимой для оформления заказа.

Класс CustomerModel представляет собой модель данных, которая работает с информацией о покупателе.
Он хранит поля данных, соответствующие интерфейсу ICustomer, и предоставляет методы для проверки, получения и сохранения этих данных.

Поля класса:
`private payment:'card' | 'cash' | null` - Способ оплаты: банковская карта или наличные \ не выбрано;
`private address: string` - Адрес доставки заказа;
`private email: string` - Электронная почта покупателя;
`private phone: string` - Контактный номер телефона покупателя;

Методы класса:
`validateOrder():boolean` -Проверяет корректность заполнения данных, необходимых на первом шаге оформления заказа: способ оплаты (payment) и адрес доставки (address). Если валидация проходит успешно, возвращает true;
`validateContacts()`- проверяет корректность контактных данных покупателя: электронная почта (email) и номер телефона (phone). Если валидация проходит успешно, возвращает true;
`getCustomer(): ICustomer` - Возвращает объект с текущими данными покупателя;
`setCustomer(data: Partial<ICustomer>): void` - Сохраняет данные покупателя. Метод позволяет передать частичный объект, чтобы обновить только указанные поля, не удаляя остальные;
`clear(): void` - Очищает все данные покупателя, сбрасывая поля в пустые или стандартные значения;


## Слой коммуникации

### Класс Communication
Cлужит прослойкой между прикладной логикой приложения и низкоуровневым классом Api. Он инкапсулирует конкретные запросы к серверу и описывает бизнес-интерфейс взаимодействия с данными — получение списка товаров, получение информации о конкретном товаре и отправку заказа на сервер.

Конструктор: `constructor(api: Api)` - сохраняет переданный экземпляр API, чтобы использовать его методы get и post для выполнения конкретных запросов приложения.

Методы класса: 
`getProducts(): Promise<{ items: IProduct[]; total: number }>` - Отправляет GET-запрос на эндпоинт /product/ и получает объект с массивом товаров.
`sendOrder(customerData: ICustomer, selectedItems: string[], total: number): Promise<IOrderResponse>` -Класс передаёт на сервер объединённые данные о покупателе и списке выбранных товаров в теле запроса.


## Слой отображения

### Класс Catalog
Отвечает за размещение списка карточек товаров, полученных от презентера. Взаимодействует только с DOM: заменяет содержимое контейнера на переданные карточки. Отображает готовые карточки товаров, не создавая их самостоятельно.

Поля класса:
`protected catalogContainer: HTMLElement` - корневой элемент списка товаров.

Методы класса:
`set items(value: HTMLElement[]): void` - Заменяет содержимое каталога новым списком карточек.
`render(data: Partial<ICatalog>): HTMLElement` - Вызывает метод базового класса и обновляет DOM, если передан список карточек.

### Класс Header
Компонент для отображения шапки сайта и кнопки корзины, содержащую счетчик товаров в корзине.

Поля класса:
`counterElement: HTMLElement` — DOM-узел со счётчиком.
`basketButton: HTMLButtonElement` — кнопка корзины.

Методы класса:
`set counter(value: number)` — обновляет значение счётчика.
`render(data: Partial<IHeader>): HTMLElement` — применяет данные и рендерит компонент.

### Класс Modal
Компонент модального окна — универсальная оболочка для любых всплывающих отображений. Используется для отображения: просмотра товара, корзины, оформления заказа, успешного заказа.

Поля класса:
`modalContainer: HTMLElement` — корневой контейнер модального окна.
`modalContent: HTMLElement` — внутренний блок, куда помещается контент.
`closeButton: HTMLButtonElement` — кнопка закрытия.

Методы класса:
`set content(element: HTMLElement)` — вставляет новый элемент в модальное окно.
`open()` — показывает модальное окно.
`close()` — скрывает его.
`render(data: Partial<IModal>): HTMLElement` — универсальный метод рендера.

### Класс OrderSuccess
Компонент отображения сообщения об успешном оформлении заказа. Показывается в модальном окне после успешной оплаты.

Поля класса:
`closeButton: HTMLButtonElement` — кнопка возврата в магазин.
`description: HTMLElement`   — элемент с текстом о количестве списанных синапсов за заказ.

Методы класса:
`setAmount(amount: number)` — обновляет текст.
`render(data?: Partial<IOrderSuccess>)` — универсальный метод рендера.

### Класс Card
Это абстрактный компонент представления, который служит основой для всех карточек товара в приложении.
Он расширяет базовый класс Component<ICard> и добавляет логику отображения: заголовка товара, цены, идентификатора карточки. Класс используется дочерними компонентами для создания различных видов карточек (например, карточка в каталоге, карточка в корзине, карточка в модальном окне).

Конструктор: `constructor(protected events: IEvents, container: HTMLElement)` - в аргументы принимает экземпляр брокера событий IEvents, позволяющий компоненту отправлять события, container — корневой DOM-элемент карточки. В конструкторе происходит вызов конструктора базового класса Component, поиск и сохранение сылок на DOM-элементы карточки (заголовка и цены).

Поля класса:
`protected titleElement: HTMLElement` - Ссылка на DOM элемент, отображающий название товара.
`protected priceElement: HTMLElement` - Ссылка на DOM элемент, отображающий цену товара.

Методы класса:
`set title(value: string)` - Обновляет текст заголовка карточки.
`set price(value: number | null)` - Обновляет отображение цены: при числовом значении показывает цену в синапсах ("123 синапсов"),при null отображает "Бесценно".
`set id(value: string)` - Устанавливает идентификатор товара как data-атрибут для корневого контейнера. Используется утилита setElementData, позволяющая добавить любые data-* атрибуты.
`render(data?: Partial<ICard>): HTMLElement` — универсальный метод рендера.

#### Класс Card-basket
Компонент визуального слоя, представляющий товар внутри корзины. Наследуется от базового класса Card и добавляет элементы, специфичные для отображения позиции корзины: порядковый номер и кнопку удаления.Компонент используется при рендеринге корзины и обеспечивает интерактивное удаление товаров.

Поля класса:
`protected removeButton: HTMLButtonElement` — кнопка удаления товара из корзины.
`protected cardIndexElement: HTMLElement`— элемент, показывающий порядковый номер товара.

Методы класса:
`set cardIndex(value: number)` - Устанавливает порядковый номер карточки.
`render(data?: Partial<ICardBasket>): HTMLElement` — универсальный метод рендера.

#### Класс Card-catalog
Класс представления карточки товара в каталоге. Наследуется от базового класса Card и расширяет его функциональность полями и логикой, необходимой для отображения изображения товара и его категории.

Конструктор `constructor(protected events: IEvents, container: HTMLElement)` - в аргументы принимает экземпляр брокера событий IEvents, позволяющий компоненту отправлять события, container — корневой DOM-элемент карточки. В конструкторе происходит вызов конструктора базового класса Card , поиск и сохранение DOM-элементов (изображение и категория товара).

Поля класса:
`protected imageElement: HTMLImageElement` - элемент <img> карточки, представляющий изображение товара.
`protected categoryElement: HTMLElement` - элемент, в котором отображается категория товара.

Методы класса:
`set image(src: string)` - Устанавливает источник изображения.
`set category(value: string)` - Устанавливает категорию товара и CSS-класс, используя константу ` categoryMap`
`render(data?: Partial<ICardCatalog>): HTMLElement` — универсальный метод рендера.


#### Класс Card-preview
Класс для отображения карточки предпросмотра в модальном окне, где отображается полная информация о товаре; содержит кнопку покупки / удаления из корзины (при наличии цены у товара).

Поля класса:
`protected imageElement: HTMLImageElement` - большое изображение товара.
`protected descriptionElement: HTMLElement` - текст описания товара.
`protected cardButton: HTMLButtonElement` - кнопка покупки/удаления.
`protected categoryElement: HTMLElement` - текст категории товара.

Методы класса:
`set description(value: string)` - Отображает описание товара.
`set category(value: string)` - Устанавливает категорию/тип товара.
`set image(value: string)` - Устанавливает картинку предпросмотра.
`render(data?: Partial<ICardPreview> | undefined): HTMLElement` — универсальный метод рендера.

### Класс Form
Абстрактный базовый класс для всех форм в приложении интернет-магазина.
Обеспечивает общую логику: вывод и очистку ошибок, управление состоянием кнопки отправки, единый процесс привязки обработчиков, стандартный механизм рендеринга.От него наследуются: OrderForm — форма выбора оплаты и адреса; ContactsForm — форма ввода email и телефона

Поля класса:
`protected errorContainer: HTMLElement` - Контейнер для вывода текста ошибок форм.
`protected submitButton: HTMLButtonElement` - Кнопка отправки формы.

Методы класса:
`clearErors(): void` - Очищает контейнер ошибок. Используется при обновлении формы или при исправлении ошибок.
`showErrors(errors: { [key: string]: string }): void` - Принимает объект ошибок и выводит их в errorContainer.
`setSubmitEnabled(enabled: boolean): void` - Включает/отключает кнопку отправки формы.
`protected abstract bindHandlers(): void` - Абстрактный метод — каждая форма обязана определить свои обработчики событий.
`render(data?: T): HTMLElement` - Переопределённый метод рендеринга, автоматически вызывает bindHandlers()

#### Класс ContanctsForm
Форма оформления заказа. Собирает контактные данные покупателя: email, телефон

Поля класса:
`protected emailInput: HTMLInputElement` - Поле ввода email.
`protected phoneInput: HTMLInputElement` - Поле ввода телефона.

Методы класса:
`setEmail(email: string): void` - Устанавливает значение поля email.
`setPhone(phone: string): void` - Устанавливает значение поля телефона.
`protected bindHandlers(): void` - регистрация событий формы (изменение полей и отправка формы)


#### Класс OrderForm
Форма оформления заказа. Реализует ввод данных: кнопка выбора метода оплаты и адрес для доставки.

Поля класса:
`protected paymentButtons: HTMLButtonElement[]` - Кнопки выбора способа оплаты.
`protected addressInput: HTMLInputElement` - Поле ввода адреса.

Методы класса:
`protected bindHandlers(): void` - регистрация событий формы (выбор способа оплаты, клик по кнопке "далее")
`setSelectedPayment(payment: PaymentType): void` -  Переключает активное состояние кнопки выбора метода оплаты;
`setAddress(address: string): void` - обновляет поле ввода адреса.


## События, генирируемые приложением
Содержит все события, которые компоненты приложения генерируют через Events.emit()

`card:select, { id: string}` - генериуется классом Card-catalog при клике на карточку в каталоге, передает id выбранного товара;
`card:toggle`- генерируется классом Card-preview при клике по кнопке добавить / удалить товар;
`cart:open` - генерируется классом Header при клике по иконке корзины;
`basket:submit` - генерируется классом Basket при клике по кнопке оплаты заказа;
`card:remove` - генерируется классом Card-basket при клике на кнопку удаления товара;
`order:payment-change` - генерируется классом OderForm при выборе метода оплаты;
`order:submit` - генерируется классом OrderForm при нплике по кнопке "далее";
`form:change` - генерируется родительским классом Form при изменении данных в любой из форм;
`order:validation-result` - генерируется CustomerModel при валидации первой формы, включает\отключает кнопку "далее";
`contacts:validation-result` - генерируется CustomerModel при валидации второй формы, включает\отключает кнопку "оплатить";
`form:contacts-submit`- генерируется классом ContactsForm при клике по кнопке "оплатить";
`catalog:changed` - генерируется CatalogModel при загрузке нового массива карточек;
`catalog:item-selected` - генерируется CatalogModel при выборе товара пользователем;

## Презентер
Отвечает за связываение всех остальных компанентов приложения (Моделей данных, Слой представления, Коммуникации). Создает экземпляры классов для всех моделей данных, классов отображения, и брокера событий.
Выступает в роли слушателя событий генерируемых моделями данных и слоем отображения, обрабатывает события вызывая соответствующие методы других компанентов для изменения данных и визуального
обновления интерфейса.
